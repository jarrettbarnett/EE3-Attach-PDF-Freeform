# Freeform Attach Uploaded Files To Email Notifications

This add-on bridges two popular ExpressionEngine add-ons, *Freeform* and *PDF Press*, thereby allowing you to generate PDFs with *PDF Press* and having them attached to your *FreeForm* submissions.

## Setup

1. The following "hidden fields" will need to be created in FreeForm and associated with the "Form" of choice.

* pdf_press_entries - the entry_ids to include in the report
* pdf_press_template - the template for PDF Press to call
* pdf_press_upload_fieldname - the Freeform fieldname for the file_upload field (we associate the PDF Press file to the field)
* pdf_press_filename_fieldname - we store a string of the filename in this field

2. A "file_upload" field needs to be created in *FreeForm* which will be used to store and reference the PDF that is 
generated by *PDF Press*. You can name this field anything you like, e.g. "report". Once you've created this field, you 
just need to specify that name in the "pdf_press_upload_fieldname" hidden form field.

3. If you're using a generic *FreeForm*  template, you may wish to exclude these settings fields from your *FreeForm* email notification. Notice how we're intentionally excluding the hidden fields in the first example below.


### Example: freeform_pdf_press.html

    <section>
        {exp:freeform:form
            form_name="contact"
            return="site/report_builder"
            notify_user="yes"
            user_email_field="email"
        }
        <dl>
            {freeform:all_form_fields}
                {if freeform:field_type != 'hidden'}
                    <dt><label>{freeform:field_label}</label></dt>
                    <dd>{freeform:field_output}</dd>
                {/if}
            {/freeform:all_form_fields}
            <input type="hidden" name="pdf_press_entries" value="{exp:cookie_fav:favourites}{if has_favourites}{favourites_entry_ids}{/if}{/exp:cookie_fav:favourites}"/>
            <input type="hidden" name="pdf_press_template" value="site/email_pdf_report" />
            <input type="hidden" name="pdf_press_upload_fieldname" value="report" />
            <input type="hidden" name="pdf_press_filename_fieldname" value="report_filename" />
        </dl>
        {if freeform:captcha}
        <p>Please enter the word you see in the image below:</p>
        <p>
            {freeform:captcha}
            <input type="text" name="captcha" />
        </p>
        {/if}
        <p>{freeform:submit}</p>
        {if freeform:no_results}
        <p>
            Specified form was not found. Please make sure you have specified the
            correct short name of the form in the <b>form_name</b> parameter.
        </p>
        {/if}
        {/exp:freeform:form}
    </section>

### Example: pdf_press_template.html

    <!doctype html>
    <html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <title>Report Builder</title>
    </head>
    <body>
    <section class="report-section">
        <div class="text-block">
            <h1>Report Builder</h1>
        </div>
    
        {exp:jb_attachpdf:get_entries entries="{segment_3}" prefix="jb" parse="inward"}
                {exp:channel:entries limit="20" entry_id="{jb:entries}"}
                    <h1>{title}</h1>
                    {page_content}
                    {city_intro_content}
                    {city_sidebar_content}
                    {city_main_content}
                {/exp:channel:entries}
        {/exp:jb_attachpdf:get_entries}
    
    </section>
    </body>
    </html>

### Example: get_entries() helper
    
This tag takes a hyphen separated list of entry IDS and converts them to be pipe delimited. This is useful when passing a list of entry IDs from our FreeForm form and sending them to

    {exp:jb_attachpdf:get_entries entries="{segment_3}" prefix="jb" parse="inward"}
        {jb:entries}
    {/exp:jb_attachpdf:get_entries}
    
    

#### Parameters:
* entries (required): hyphenated list of entries, e.g. 5-13-17 (for entries 5, 13, and 17)
* prefix (optional): the prefix to use (defaults to "jb" when not provided . Note that the colon is added automatically)


### Possible Improvements

Future improvements can be made to the add-on where-as the generated PDFs are not stored on the server; however, it may come in handy being able to view the generated PDFs via the Freeform backend.
Alternatively, a crontask could be written to remove all PDFs older than 30 days by utilizing PHP date() methods and wildcard operators like "*": e.g. $ rm custom-report-20161226* . which would remove all PDFs generated on 2016-12-26

This add-on is not maintained but I'll gladly accept pull requests that aim at abstracting more of the logic or centralizing the settings.

